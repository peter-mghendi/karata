@page "/game/{id:guid}"

@using Karata.Kit.Application.Client
@using TextCopy

@inject KarataClient KarataClient

<MudLoading Loading="@(_room is null)" Text="Please wait..." Class="mud-height-full pa-0">
    <MudContainer MaxWidth="MaxWidth.Large" Class="mud-height-full py-4">
        @if (_room is not null)
        {
            <MudPaper Class="pa-4 mb-4">
                <InformationPanel Subheader Room="_room"/>
                <PlayersPanel Subheader Room="_room" />
                <MudDivider Class="my-2"/>
                
                @if (_room.Game.Status is GameStatus.Lobby or GameStatus.Ongoing)
                {
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="@($"/game/{_room.Id}/play")">
                        Join
                    </MudButton>
                    <MudButton Variant="Variant.Outlined" Href="@($"/game/{_room.Id}/spectate")" Class="ml-2">
                        Spectate
                    </MudButton>
                }
                
                @if (_room.Game.Status is GameStatus.Over)
                {
                    <MudButton Variant="Variant.Outlined" Href="@($"/game/{_room.Id}/replay")" Class="ml-2">
                        Replay
                    </MudButton>
                }
            </MudPaper>
        }
    </MudContainer>
</MudLoading>

@code
{
    [Parameter] public Guid Id { get; set; }

    [Inject] public required IClipboard Clipboard { get; set; }

    private RoomData? _room;

    protected override async Task OnInitializedAsync()
    {
        _room = await KarataClient.Rooms.GetAsync(Id);
    }
}